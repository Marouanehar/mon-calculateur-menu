<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Menu & Food Cost</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .card { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900 pb-10">

    <div class="max-w-4xl mx-auto p-4">
        <header class="text-center my-8">
            <h1 class="text-3xl font-black text-blue-900 uppercase tracking-tight">Calculateur de Menu</h1>
            <p class="text-slate-500 font-medium">Analyse des co√ªts et r√©partition du prix de vente</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 space-y-4">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-blue-800">
                        <span>üìã</span> Infos Plat
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Nom du Plat / Menu</label>
                            <input type="text" id="itemName" value="Menu Signature" oninput="updateCalculations()" class="w-full mt-1 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Prix de Vente TTC (DH)</label>
                            <input type="number" id="salesPrice" value="100" oninput="updateCalculations()" class="w-full mt-1 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-700">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Remise (%)</label>
                            <input type="number" id="discount" value="0" oninput="updateCalculations()" class="w-full mt-1 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <div class="bg-blue-900 text-white p-6 rounded-3xl shadow-lg shadow-blue-200">
                    <h2 class="text-xs font-bold opacity-70 uppercase mb-4">R√©capitulatif Financier</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm opacity-80">Prix TTC Net :</span>
                            <span id="netPrice" class="font-bold">0.00 DH</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm opacity-80">Co√ªt Ingr√©dients :</span>
                            <span id="totalCost" class="font-bold">0.00 DH</span>
                        </div>
                        <div class="pt-3 border-t border-blue-800 flex justify-between items-end">
                            <span class="text-sm opacity-80">Marge Brute :</span>
                            <span id="margin" class="text-2xl font-black text-green-400">0.00 DH</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-bold text-blue-800">ü•ë Ingr√©dients de la recette</h2>
                        <button onclick="addIngredient()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm font-bold transition-all shadow-md shadow-blue-100">+ Ajouter</button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-[10px] uppercase text-slate-400 font-black border-b border-slate-100">
                                    <th class="pb-3 px-2">Ingr√©dient</th>
                                    <th class="pb-3 px-2 w-28">Prix Achat</th>
                                    <th class="pb-3 px-2 w-20">Ratio</th>
                                    <th class="pb-3 px-2 w-32">Ventilation PV</th>
                                    <th class="pb-3"></th>
                                </tr>
                            </thead>
                            <tbody id="ingredientBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ingredients = [
            { id: Date.now(), name: "Viande", price: 30 },
            { id: Date.now() + 1, name: "L√©gumes", price: 10 }
        ];

        function addIngredient() {
            ingredients.push({ id: Date.now(), name: "", price: 0 });
            renderIngredients();
        }

        function removeIngredient(id) {
            ingredients = ingredients.filter(ing => ing.id !== id);
            updateCalculations();
        }

        function updateIngredient(id, field, value) {
            const ing = ingredients.find(i => i.id === id);
            if (ing) {
                ing[field] = field === 'price' ? parseFloat(value) || 0 : value;
                updateCalculations();
            }
        }

        function updateCalculations() {
            const salesPrice = parseFloat(document.getElementById('salesPrice').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            // 1. Calcul Prix Net
            const netPrice = salesPrice * (1 - discount / 100);
            
            // 2. Co√ªt total ingr√©dients
            const totalCost = ingredients.reduce((sum, ing) => sum + ing.price, 0);

            // 3. Ratios et Ventilation du PV
            ingredients.forEach(ing => {
                ing.ratio = totalCost > 0 ? (ing.price / totalCost) : 0;
                ing.allocatedPrice = netPrice * ing.ratio;
            });

            // Affichage Header
            document.getElementById('netPrice').innerText = netPrice.toFixed(2) + " DH";
            document.getElementById('totalCost').innerText = totalCost.toFixed(2) + " DH";
            document.getElementById('margin').innerText = (netPrice - totalCost).toFixed(2) + " DH";

            renderIngredients();
        }

        function renderIngredients() {
            const body = document.getElementById('ingredientBody');
            body.innerHTML = '';

            ingredients.forEach(ing => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-slate-50 group hover:bg-slate-50 transition-colors";
                tr.innerHTML = `
                    <td class="py-4 px-2">
                        <input type="text" value="${ing.name}" oninput="updateIngredient(${ing.id}, 'name', this.value)" 
                               placeholder="Nom..." class="bg-transparent border-none focus:ring-0 w-full font-medium text-sm">
                    </td>
                    <td class="py-4 px-2">
                        <input type="number" value="${ing.price}" oninput="updateIngredient(${ing.id}, 'price', this.value)" 
                               class="bg-slate-100 border-none rounded-lg p-2 w-full text-sm font-bold text-slate-700">
                    </td>
                    <td class="py-4 px-2">
                        <span class="text-xs font-bold text-slate-400">${((ing.ratio || 0) * 100).toFixed(1)}%</span>
                    </td>
                    <td class="py-4 px-2">
                        <span class="text-sm font-black text-blue-600">${(ing.allocatedPrice || 0).toFixed(2)} DH</span>
                    </td>
                    <td class="py-4 px-2 text-right">
                        <button onclick="removeIngredient(${ing.id})" class="text-slate-300 hover:text-red-500 transition-colors">‚úï</button>
                    </td>
                `;
                body.appendChild(tr);
            });
        }

        // Init
        updateCalculations();
    </script>
</body>
</html>
