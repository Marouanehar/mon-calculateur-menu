function calculateAll(d25, d26) {
            globalData = []; productData = []; cdgSums = { 2025: {}, 2026: {} }; orientSums = { 2025: {}, 2026: {} }; orientArticleSums = { 2025: {}, 2026: {} }; orientTotals = { 2025: {}, 2026: {} }; brutMatrix = { 2025: {}, 2026: {} }; chariotCA = { 2025: 0, 2026: 0 }; realLivTotal = { 2025: 0, 2026: 0 };
            const agg = (data, year) => {
                const currentDisp = dispatchMaps[year];
                data.forEach(row => {
                    const ca = parseFloat(row['CA HT'] || row['CA'] || 0), siteFull = (row['Nom Site'] || "").toUpperCase(), code = String(row['Code article'] || row['Code']);
                    
                    // CORRECTION ICI : Priorité à la colonne "Nom Code article" comme demandé
                    const nameFromFile = row['Nom Code article'] || row['Désignation'] || row['Article'] || "NOM INCONNU";
                    const info = families[code] || { famille: "AUTRES", type: "RESTO", designation: "" };
                    const finalName = info.designation || nameFromFile;

                    if (siteFull.includes("LIVRAISON")) realLivTotal[year] += ca;
                    let site = SITES_LIST.find(s => siteFull.includes(s)) || (siteFull.includes("CHARIOT") ? "CHARIOT" : "RABAT SIÈGE");
                    
                    pushData(site, info.famille, ca, year, info.type);
                    pushProductData(site, info.famille, code, finalName, ca, year);
                    
                    if (site === "CHARIOT") chariotCA[year] += ca;
                    if (site === "RABAT SIÈGE") {
                        brutMatrix[year][info.famille] = (brutMatrix[year][info.famille] || 0) + ca;
                        if(currentDisp[code]) currentDisp[code].forEach(i => cdgSums[year][i.family] = (cdgSums[year][i.family] || 0) + (ca * i.ratio));
                        if(ORIENT_CONFIG[code]) { const cfg = ORIENT_CONFIG[code]; orientArticleSums[year][info.famille] = (orientArticleSums[year][info.famille] || 0) + ca; orientTotals[year][cfg.name] = (orientTotals[year][cfg.name] || 0) + ca; Object.keys(cfg.split).forEach(fam => orientSums[year][fam] = (orientSums[year][fam] || 0) + (ca * cfg.split[fam])); }
                    }
                });
            };
            agg(d25, 2025); agg(d26, 2026);
            document.getElementById('real_liv_25').innerText = f(realLivTotal[2025]); document.getElementById('real_liv_26').innerText = f(realLivTotal[2026]);
            renderAll();
            initFocusFilters();
        }
